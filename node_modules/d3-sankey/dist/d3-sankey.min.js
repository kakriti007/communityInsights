// https://github.com/d3/d3-sankey v0.11.0 Copyright 2019 Mike Bostock
!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-array"),require("d3-collection"),require("d3-shape")):"function"==typeof define&&define.amd?define(["exports","d3-array","d3-collection","d3-shape"],t):t((n=n||self).d3=n.d3||{},n.d3,n.d3,n.d3)}(this,function(n,t,e,r){"use strict";function o(n){return n.target.depth}function i(n,t){return n.sourceLinks.length?n.depth:t-1}function u(n){return function(){return n}}function c(n,t){return s(n.source,t.source)||n.index-t.index}function f(n,t){return s(n.target,t.target)||n.index-t.index}function s(n,t){return n.y0-t.y0}function a(n){return n.value}function l(n){return n.index}function h(n){return n.nodes}function d(n){return n.links}function y(n,t){var e=n.get(t);if(!e)throw new Error("missing: "+t);return e}function g(n){return[n.source.x1,n.y0]}function k(n){return[n.target.x0,n.y1]}n.sankey=function(){var n,r,o=0,g=0,k=1,p=1,L=24,E=8,v=l,x=i,w=h,m=d,b=6;function M(){var i={nodes:w.apply(null,arguments),links:m.apply(null,arguments)};return function(n){n.nodes.forEach(function(n,t){n.index=t,n.sourceLinks=[],n.targetLinks=[]});var t=e.map(n.nodes,v);n.links.forEach(function(n,e){n.index=e;var r=n.source,o=n.target;"object"!=typeof r&&(r=n.source=y(t,r)),"object"!=typeof o&&(o=n.target=y(t,o)),r.sourceLinks.push(n),o.targetLinks.push(n)})}(i),function(n){n.nodes.forEach(function(n){n.value=Math.max(t.sum(n.sourceLinks,a),t.sum(n.targetLinks,a))})}(i),function(n){var t,e,r,i=n.nodes.length;for(t=n.nodes,e=[],r=0;t.length;++r,t=e,e=[]){if(r>i)throw new Error("circular link");t.forEach(function(n){n.depth=r,n.sourceLinks.forEach(function(n){e.indexOf(n.target)<0&&e.push(n.target)})})}for(t=n.nodes,e=[],r=0;t.length;++r,t=e,e=[]){if(r>i)throw new Error("circular link");t.forEach(function(n){n.height=r,n.targetLinks.forEach(function(n){e.indexOf(n.source)<0&&e.push(n.source)})})}var u=(k-o-L)/(r-1);n.nodes.forEach(function(n){n.layer=Math.max(0,Math.min(r-1,Math.floor(x.call(null,n,r)))),n.x1=(n.x0=o+n.layer*u)+L})}(i),function(o){var i,u=e.nest().key(function(n){return n.x0}).sortKeys(t.ascending).entries(o.nodes).map(function(n){return n.values});i=t.min(u,function(n){return(p-g-(n.length-1)*E)/t.sum(n,a)}),u.forEach(function(t){null!=n&&t.sort(n);let e=g;t.forEach(function(n){n.y0=e,n.y1=e+n.value*i,e=n.y1+E})}),o.links.forEach(function(n){n.width=n.value*i}),null!=r&&o.nodes.forEach(function(n){n.sourceLinks.sort(r),n.targetLinks.sort(r)});for(var c=0,f=b;c<f;++c){const n=Math.pow(.99,c),t=(c+1)/f;j(o),h(n),d(t),y(t),j(o),l(n),d(t),y(t)}function l(n){u.slice(1).forEach(function(t){t.forEach(function(t){let e=0,r=0;for(const{source:n,value:o}of t.targetLinks){let i=o*(t.layer-n.layer);e+=z(n,t)*i,r+=i}if(!(r>0))return;let o=(e/r-t.y0)*n;t.y0+=o,t.y1+=o})})}function h(n){u.slice(0,-1).reverse().forEach(function(t){t.forEach(function(t){let e=0,r=0;for(const{target:n,value:o}of t.sourceLinks){let i=o*(n.layer-t.layer);e+=O(t,n)*i,r+=i}if(!(r>0))return;let o=(e/r-t.y0)*n;t.y0+=o,t.y1+=o})})}function d(t){u.forEach(function(e){var r,o,i,u=g,c=e.length;for(void 0===n&&e.sort(s),i=0;i<c;++i)r=e[i],(o=(u-r.y0)*t)>1e-6&&(r.y0+=o,r.y1+=o),u=r.y1+E})}function y(t){u.forEach(function(e){var r,o,i,u=p,c=e.length;for(void 0===n&&e.sort(s),i=c-1;i>=0;--i)r=e[i],(o=(r.y1-u)*t)>1e-6&&(r.y0-=o,r.y1-=o),u=r.y0-E})}}(i),q(i),i}function j(n){void 0===r&&n.nodes.forEach(function(n){n.sourceLinks.sort(f),n.targetLinks.sort(c)})}function q(n){j(n),n.nodes.forEach(function(n){var t=n.y0,e=t;n.sourceLinks.forEach(function(n){n.y0=t+n.width/2,t+=n.width}),n.targetLinks.forEach(function(n){n.y1=e+n.width/2,e+=n.width})})}function z(n,t){let e=n.y0-(n.sourceLinks.length-1)*E/2;for(const{target:r,width:o}of n.sourceLinks){if(r===t)break;e+=o+E}for(const{source:r,width:o}of t.targetLinks){if(r===n)break;e-=o}return e}function O(n,t){let e=t.y0-(t.targetLinks.length-1)*E/2;for(const{source:r,width:o}of t.targetLinks){if(r===n)break;e+=o+E}for(const{target:r,width:o}of n.sourceLinks){if(r===t)break;e-=o}return e}return M.update=function(n){return q(n),n},M.nodeId=function(n){return arguments.length?(v="function"==typeof n?n:u(n),M):v},M.nodeAlign=function(n){return arguments.length?(x="function"==typeof n?n:u(n),M):x},M.nodeSort=function(t){return arguments.length?(n=t,M):n},M.nodeWidth=function(n){return arguments.length?(L=+n,M):L},M.nodePadding=function(n){return arguments.length?(E=+n,M):E},M.nodes=function(n){return arguments.length?(w="function"==typeof n?n:u(n),M):w},M.links=function(n){return arguments.length?(m="function"==typeof n?n:u(n),M):m},M.linkSort=function(n){return arguments.length?(r=n,M):r},M.size=function(n){return arguments.length?(o=g=0,k=+n[0],p=+n[1],M):[k-o,p-g]},M.extent=function(n){return arguments.length?(o=+n[0][0],k=+n[1][0],g=+n[0][1],p=+n[1][1],M):[[o,g],[k,p]]},M.iterations=function(n){return arguments.length?(b=+n,M):b},M},n.sankeyCenter=function(n){return n.targetLinks.length?n.depth:n.sourceLinks.length?t.min(n.sourceLinks,o)-1:0},n.sankeyLeft=function(n){return n.depth},n.sankeyRight=function(n,t){return t-1-n.height},n.sankeyJustify=i,n.sankeyLinkHorizontal=function(){return r.linkHorizontal().source(g).target(k)},Object.defineProperty(n,"__esModule",{value:!0})});
